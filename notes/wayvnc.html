<!DOCTYPE html>

<html>
    <head>
        
        <title>Empty Space - 使用无头的wayvnc做远程桌面——乱水</title>
        
        <meta charset="UTF-8">
        <meta content="width=device-width, initial-scale=1, viewport-fit=cover" name="viewport">

        
        <meta name="description" content="虽说服务器上一般没有必要跑图形界面，但还是偶尔会碰到有些烦人的程序CLI不能跑端解决的问题。不过前几天我发现了WayVNC，十分适合没有物理屏幕的远程服务器。一方面是FAQ里写得清清楚楚，另一方面是用wlroots做合成器〔Compositor〕的窗口管理器，比如sway，十分的轻量。图省事我用了Nix来安装。">
        

        
        <meta name="keywords" content="note,破事水,远程桌面,wayvnc,wayland,sway">
        

        <link rel="stylesheet" href="//nth233.top/assets/style/main.css">
        <link rel="stylesheet" href="//nth233.top/assets/style/tango.css">
        <link rel="stylesheet" href="//nth233.top/assets/style/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous">

        
        
        <link rel="apple-touch-icon" sizes="180x180" href="//nth233.top/assets/favicon/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="//nth233.top/assets/favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="//nth233.top/assets/favicon/favicon-16x16.png">
        <link rel="manifest" href="//nth233.top/assets/favicon/site.webmanifest">
        
    </head>
    <body>
        <header>

<div class="header-logo">
    <img class="nth233logo" src="//nth233.top/assets/img/404.png"></img>
    <a href="//nth233.top/">Empty Space</a>
</div>

<div class="header-menu">
    <a href="//nth233.top/notes/">Notes</a>
    <a href="//nth233.top/about/">About</a>
    <a href="//nth233.top/feed.xml">RSS</a>
    <!--<a href="//nth233.top/friends.html">Friends</a>-->
    <div id="theme-switch" title="夜幕降临">🌒</button>
</div>

</header>

        <main>
            
<div class='post-menu'>
    <div class='menu-title'>使用无头的wayvnc做远程桌面——乱水</div>
    <hr>
</div> 
<div class="post-area">
<div class="post-front-matter">
    
    <h1>使用无头的wayvnc做远程桌面——乱水</h1>
    
    <div class="date-bar">
        <span class="date">2022-12-5</span>
    </div>
    <div class="category-bar">
    
        <span class="category">〔note〕</span>
    
    </div>
    <div class="tag-bar">
    
        <span class="tag">#note</span>
    
        <span class="tag">#破事水</span>
    
        <span class="tag">#远程桌面</span>
    
        <span class="tag">#wayvnc</span>
    
        <span class="tag">#wayland</span>
    
        <span class="tag">#sway</span>
    
    </div>
</div>
<hr class="hr-wavy">
<div class="post-content">
    <h2 id="起因">起因</h2>
<p>虽说服务器上一般没有必要跑图形界面，但还是偶尔会碰到有些烦人的程序CLI不能跑，比如百度网盘。</p>
<p>正巧，远古MC存档的备份就在百度网盘上……最后折腾了半天，也没成功把远程桌面搞起来，最后还是用<code>Baidupcs-Go</code>这个第三方CLI客户端解决的问题。</p>
<p>不过前几天我发现了<code>WayVNC</code>，十分适合没有物理屏幕的远程服务器。一方面是FAQ里写得清清楚楚，另一方面是用<code>wlroots</code>做合成器〔Compositor〕的窗口管理器，比如<code>sway</code>，十分的轻量。</p>
<h2 id="搭建">搭建</h2>
<p>因为阿里云的服务器用的是debian 10
buster这个远古版本，包基本上旧得不行，比如就没有sway。要安装可以参照<a
href="https://github.com/swaywm/sway/wiki/Debian-10-(Buster)-Installation">sway的wiki关于debian
10的这篇文章</a>手动编译，麻烦的很。所以选择用Nix。</p>
<h3 id="安装nix">安装Nix</h3>
<p>参照<a
href="https://nixos.org/download.html#download-nix">Nix的文档</a>.</p>
<p>执行脚本，安装Nix（多用户）:</p>
<div class="highlight"><pre><span></span>$<span class="w"> </span>sh<span class="w"> </span>&lt;<span class="o">(</span>curl<span class="w"> </span>-L<span class="w"> </span>https://nixos.org/nix/install<span class="o">)</span><span class="w"> </span>--daemon
</pre></div>

<p>然后重启一下服务器。Nix就安装好了。</p>
<h3 id="安装所需的软件包">安装所需的软件包</h3>
<div class="highlight"><pre><span></span>nix-env<span class="w"> </span>--install<span class="w"> </span>--attr<span class="w"> </span>sway<span class="w"> </span>wayvnc
</pre></div>

<p>我习惯安个浏览器和终端仿真器</p>
<div class="highlight"><pre><span></span>nix-env<span class="w"> </span>--install<span class="w"> </span>--attr<span class="w"> </span>firefox<span class="w"> </span>konsole
</pre></div>

<blockquote>
<p>为什么是Qt写的konsole？因为我发现更轻量的kitty和alacritty都没法用，似乎都和openGL没法使用有关。至于为什么openGL没法用，我不太懂。</p>
</blockquote>
<p>然后记得配置一下sway。</p>
<h3 id="启动wayvnc">启动<code>wayvnc</code></h3>
<p>首先进入<code>nix-shell</code>。</p>
<div class="highlight"><pre><span></span>nix-shell<span class="w"> </span>-p<span class="w"> </span>sway<span class="w"> </span>wayvnc<span class="w"> </span>firefox<span class="w"> </span>konsole
</pre></div>

<p>然后按照<a
href="https://github.com/any1/wayvnc/blob/master/FAQ.md">WayVNC的FAQ</a>，以无头〔headless〕模式启动sway。</p>
<p>设置三个环境变量</p>
<div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">WLR_BACKENDS</span><span class="o">=</span>headless
<span class="nb">export</span><span class="w"> </span><span class="nv">WLR_LIBINPUT_NO_DEVICES</span><span class="o">=</span><span class="m">1</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">WAYLAND_DISPLAY</span><span class="o">=</span>wayland-1
</pre></div>

<p>然后启动sway：</p>
<div class="highlight"><pre><span></span>sway<span class="w"> </span><span class="p">&amp;</span><span class="w"> </span><span class="c1"># 加上&amp;是为了sway可以在后台运行</span>
</pre></div>

<p>然后启动WayVNC</p>
<div class="highlight"><pre><span></span>wayvnc<span class="w"> </span><span class="m">0</span>.0.0.0<span class="w"> </span><span class="m">2304</span><span class="w"> </span><span class="c1"># 端口号改成自己需要的</span>
</pre></div>

<p>如果一切正常，那么现在可以用VNC工具，比如<code>vinagre</code>，连接远程桌面了。</p>
<blockquote>
<p>注意！如果不进一步配置，那么这个连接没有任何密码、没有加密，也就不安全。如果要长期开着WayVNC，建议加上身份校验，参考<a
href="https://github.com/any1/wayvnc">WayVNC的GitHub页面</a>。</p>
</blockquote>
<p>如果要调整屏幕的大小，开启sway之后执行下面的命令：</p>
<div class="highlight"><pre><span></span>swaymsg<span class="w"> </span>output<span class="w"> </span><span class="s2">&quot;HEADLESS-1&quot;</span><span class="w"> </span>resolution<span class="w"> </span>1920x1080<span class="w"> </span><span class="c1"># 大小自己调</span>
</pre></div>

<h2 id="后记">后记</h2>
<p>虽说服务器带宽有点小，画面传过来有点卡顿掉帧，但毕竟不是不能用……应付偶尔的需求足够了。</p>

</div>

<div class="sibling-pages">
    
    <div class="sibling-page-arrow"><a href="//nth233.top/notes/buzzing.html">〈</a></div>
    <div class="sibling-page sibling-page-next">
        <div class="sibling-page-title"><a href="//nth233.top/notes/buzzing.html">解决Linux下音...</a></div>
        <div class="sibling-page-date">2023-9-24</div>
    </div>
    
    
    <div class="sibling-page sibling-page-last">
        <div class="sibling-page-title"><a href="//nth233.top/notes/median-algo.html">找中位数的线性时间...</a></div>
        <div class="sibling-page-date">2022-11-25</div>
    </div>
    <div class="sibling-page-arrow"><a href="//nth233.top/notes/median-algo.html">〉</a></div>
    
</div>




    <div class="comment-area">
<script src="https://utteranc.es/client.js"
        repo="fpg2012/fpg2012.github.io"
        issue-term="pathname"
        label="Comment"
        theme="preferred-color-scheme"
        crossorigin="anonymous"
        async>
</script>
</div>


</div>
<script src=//nth233.top/assets/js/generate-toc.js></script>

        </main>
        <footer>
<span>© nth233 2023 | <span class="theme-about">Powered by <a href="https://github.com/fpg2012/sushi">sushi</a> |  Theme <a href="https://github.com/fpg2012/sushi-theme-empty">empty</a> by <a href="https://github.com/fpg2012">nth233</a></span>
</footer>
        <div id="fullscreen-img-container" class="hidden">
        </div>
        <div id="top-button" onclick="window.scrollTo(0,0)">△</div>
	<script src="//nth233.top/assets/js/fullscreen-img.js"></script>
    <script src="//nth233.top/assets/js/switch-theme.js"></script>
    
    </body>
</html>
