<!DOCTYPE html>

<html>
    <head>
        
        <title>Empty Space - Arduinoå’Œlinuxä¸²å£é€šä¿¡</title>
        
        <meta charset="UTF-8">
        <meta content="width=device-width, initial-scale=1, viewport-fit=cover" name="viewport">

        
        <meta name="description" content="æ‰‹å¤´æœ‰ä¸€å—ï¼ˆä¼ªï¼‰Arduino Unoï¼Œç°åœ¨éœ€è¦æŠŠä¸Šé¢æµ‹åˆ°çš„ç”µå‹æ•°æ®å‘é€åˆ°ç”µè„‘ä¸Šäº†ã€‚æˆ‘çŸ¥é“Arduinoå®˜æ–¹æä¾›äº†`Serial.write`å’Œ`Serial.read`ï¼Œåˆ©ç”¨è¿™äº›å‡½æ•°å¯ä»¥æ–¹ä¾¿åœ°é€šè¿‡ä¸²å£å‘æ•°æ®ç»™ç”µè„‘ï¼Œåœ¨Arduino IDEæä¾›çš„ä¸²å£ç›‘è§†å™¨ä¸Šæ˜¾ç¤ºå‡ºæ¥ã€‚ä½†æˆ‘ç°åœ¨éœ€è¦è‡ªå·±å¤„ç†æ•°æ®ï¼Œéœ€è¦è®©Arduinoç›´æ¥å’Œæˆ‘çš„ç¨‹åºé€šä¿¡ã€‚å¯¹æ­¤æˆ‘æ¯«æ— å¤´ç»ªã€‚ä¸€ç•ªæœç´¢å°è¯•ä¹‹åç®—æ˜¯æ‰¾åˆ°äº†åŠæ³•ã€‚">
        

        
        <meta name="keywords" content="arduino,ä¸²å£,posix,linux">
        

        <link rel="stylesheet" href="//fpg2012.github.io/assets/style/main.css">
        <link rel="stylesheet" href="//fpg2012.github.io/assets/style/tango.css">
        <link rel="stylesheet" href="//fpg2012.github.io/assets/style/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous">

        
        <script async src='//cdn.jsdelivr.net/npm/valine@1.4.18/dist/Valine.min.js'></script>
        
        
        <link rel="apple-touch-icon" sizes="180x180" href="//fpg2012.github.io/assets/favicon/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="//fpg2012.github.io/assets/favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="//fpg2012.github.io/assets/favicon/favicon-16x16.png">
        <link rel="manifest" href="//fpg2012.github.io/assets/favicon/site.webmanifest">
        
    </head>
    <body>
        <header>

<div class="header-logo">
    <img class="nth233logo" src="//fpg2012.github.io/assets/img/404.png"></img>
    <a href="//fpg2012.github.io/">Empty Space</a>
</div>

<div class="header-menu">
    <a href="//fpg2012.github.io/about/">About</a>
    <a href="//fpg2012.github.io/feed.xml">RSS</a>
    <!--<a href="//fpg2012.github.io/friends.html">Friends</a>-->
    <button id="theme-switch">ğŸ…£ theme</button>
</div>

</header>

        <main>
            
<div class="post-area">
<div class="post-front-matter">
    
    <h1>Arduinoå’Œlinuxä¸²å£é€šä¿¡</h1>
    
    <div class="date-bar">
        <span class="date">2021-04-18</span>
    </div>
    <div class="category-bar">
    
        <span class="category">ã€”devã€•</span>
    
    </div>
    <div class="tag-bar">
    
        <span class="tag">#arduino</span>
    
        <span class="tag">#ä¸²å£</span>
    
        <span class="tag">#posix</span>
    
        <span class="tag">#linux</span>
    
    </div>
</div>
<hr class="hr-wavy">
<div class="post-content">
    <h2 id="å‰å› ">å‰å› </h2>
<p>æ‰‹å¤´æœ‰ä¸€å—ï¼ˆä¼ªï¼‰Arduino
Unoï¼Œç°åœ¨éœ€è¦æŠŠä¸Šé¢æµ‹åˆ°çš„ç”µå‹æ•°æ®å‘é€åˆ°ç”µè„‘ä¸Šäº†ã€‚æˆ‘çŸ¥é“Arduinoå®˜æ–¹æä¾›äº†<code>Serial.write</code>å’Œ<code>Serial.read</code>ï¼Œåˆ©ç”¨è¿™äº›å‡½æ•°å¯ä»¥æ–¹ä¾¿åœ°é€šè¿‡ä¸²å£å‘æ•°æ®ç»™ç”µè„‘ï¼Œåœ¨Arduino
IDEæä¾›çš„ä¸²å£ç›‘è§†å™¨ä¸Šæ˜¾ç¤ºå‡ºæ¥ã€‚ä½†æˆ‘ç°åœ¨éœ€è¦è‡ªå·±å¤„ç†æ•°æ®ï¼Œéœ€è¦è®©Arduinoç›´æ¥å’Œæˆ‘çš„ç¨‹åºé€šä¿¡ã€‚å¯¹æ­¤æˆ‘æ¯«æ— å¤´ç»ªã€‚ä¸€ç•ªæœç´¢å°è¯•ä¹‹åç®—æ˜¯æ‰¾åˆ°äº†åŠæ³•ã€‚</p>
<h2 id="çº¿">çº¿</h2>
<p>æˆ‘çš„Arduino
UNOå’Œè®¡ç®—æœºè¿æ¥çš„ä¾èµ–ä¸€æ ¹USBçº¿ï¼Œä¸€å¤´æ˜¯type-Bï¼Œä¸€å¤´æ˜¯type-Aï¼Œé€šè¿‡è¿™ä¸ªUSBæä¾›äº†è™šæ‹Ÿä¸²å£ï¼Œå¯ä»¥å‡æƒ³Arduinoå’Œè®¡ç®—æœºç”¨ä¸€æ¡RS-232ä¸²è¡Œæ€»çº¿è¿æ¥èµ·æ¥äº†ã€‚åˆ©ç”¨è¿™ä¸ªä¸²å£ï¼ŒArduinoå°±å¯ä»¥å’Œè®¡ç®—æœºé€šä¿¡ã€‚</p>
<p>è¿æ¥åˆ°è®¡ç®—æœºçš„Arduinoè¢«linuxåŒ…è£…æˆä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ‘è¿™é‡Œæ˜¯<code>/dev/ttyACM0</code>ï¼Œåªè¦å¯¹è¿™ä¸ªæ–‡ä»¶è¿›è¡Œå“åº”çš„è¯»å†™ï¼Œå°±å¯ä»¥å®ç°é€šä¿¡ã€‚ä½†æ˜¯æ¯•ç«Ÿä¸²å£å’Œç¡¬ç›˜ä¸Šçš„æ–‡ä»¶æœ¬è´¨ä¸Šä¸åŒï¼Œè¿˜æ˜¯å¾—é€šè¿‡ç³»ç»Ÿå¯¹å…¶è¿›è¡Œç»ˆç«¯æ§åˆ¶ã€‚linuxæä¾›äº†<code>termios.h</code>ï¼Œé‡Œé¢ç”¨ä¸€ä¸ªç»“æ„ä½“ä¿å­˜äº†ç»ˆç«¯æ§åˆ¶çš„å„ç§å±æ€§ï¼Œå±äºPOSIXæ ‡å‡†ã€‚å¾ˆå¤šä¸œè¥¿çœ‹èµ·æ¥æ˜¯ä¸Šä¸€ä¸ªæ—¶ä»£çš„é—å­˜ï¼Œä»UNIXå’Œç”µä¼ æ‰“å­—æœºçš„æ—¶ä»£ä¸€ç›´ç»§æ‰¿åˆ°äº†ç°åœ¨ã€‚</p>
<h2 id="struct-termio"><code>struct termio</code></h2>
<h3 id="ç»“æ„ä½“å†…å®¹">ç»“æ„ä½“å†…å®¹</h3>
<p><code>struct termio</code>é‡Œé¢ä¿å­˜äº†ç»ˆç«¯çš„å„ç§å±æ€§ã€‚</p>
<ol type="1">
<li><code>c_iflag</code>
è®¾ç½®è¾“å…¥æ¨¡å¼ï¼Œæ¯”å¦‚è¦ä¸è¦æµé‡æ§åˆ¶ã€è¦ä¸è¦å¯¹è¾“å…¥å­—èŠ‚è¿›è¡Œç‰¹æ®Šå¤„ç†</li>
<li><code>c_oflag</code>
è®¾ç½®è¾“å‡ºæ¨¡å¼ï¼Œæ¯”å¦‚è¦ä¸è¦å¯¹è¾“å‡ºå­—èŠ‚è¿›è¡Œç‰¹æ®Šå¤„ç†</li>
<li><code>c_cflag</code>
è®¾ç½®æ§åˆ¶æ¨¡å¼ï¼Œæ¯”å¦‚ä¸€ä¸ªå­—èŠ‚å¤šå®½ï¼Œæœ‰æ²¡æœ‰å¥‡å¶æ ¡éªŒä½ï¼Œæœ‰å‡ ä¸ªç»ˆæ­¢ä½ï¼Œè¦ä¸è¦è¿›è¡Œè½½æ³¢æ£€æµ‹ï¼Œè¦ä¸è¦è¯»æ•°æ®</li>
<li><code>c_lflag</code> è®¾ç½®å±€éƒ¨æ¨¡å¼ï¼ˆæˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆå«Local
Modeï¼‰ï¼Œæ¯”å¦‚è¦ä¸è¦å›ä¼ ã€è¦ä¸è¦ä½¿ç”¨æ ‡å‡†æ¨¡å¼ï¼ˆCanonical
Modeï¼Œä¼¼ä¹æ˜¯ä¸€è¡Œä¸€è¡Œè¯»ï¼‰</li>
<li><code>c_cc</code>
ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«ä¸€äº›ç‰¹æ®Šè®¾ç½®ï¼Œæ¯”å¦‚ä¸€æ¬¡æœ€å°‘è¯»å‡ ä¸ªå­—ç¬¦</li>
</ol>
<p>å‰é¢å‡ ä¸ªflagéƒ½æ˜¯é€šè¿‡ä½è¿ç®—è¿›è¡Œæ§åˆ¶çš„ï¼ŒæŠŠå¯¹åº”çš„ä½è®¾ä¸º1åˆ™å¯ç”¨ï¼Œå¦åˆ™ç¦ç”¨ã€‚</p>
<p>ä¸Šé¢ä¸€äº›è®¾ç½®ä¼¼ä¹åªå’Œä»¥å‰çš„è°ƒåˆ¶è§£è°ƒå™¨æœ‰å…³ï¼Œæ¯”å¦‚æµé‡æ§åˆ¶ã€è½½æ³¢ç›‘å¬ä»€ä¹ˆçš„ï¼Œå¯¹äºæˆ‘ä»¬å’ŒArduinoé€šä¿¡æ¥è¯´æ˜¯æ²¡ä»€ä¹ˆç”¨çš„ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ“ä½œç³»ç»Ÿå¯¹æˆ‘ä»¬çš„æ•°æ®åšå¤ªå¤šçš„å¤„ç†ï¼Œå› æ­¤ä½¿ç”¨çš„æ—¶å€™éœ€è¦ç¦ç”¨æ‰å¤§å¤šæ•°é…ç½®ã€‚</p>
<p>å¯¹äº<code>c_cc</code>æ•°ç»„ï¼Œé‡Œé¢<code>c_cc[VMIN]</code>è¡¨ç¤ºä¸€æ¬¡è¯»å†™å‡ ä¸ªå­—ç¬¦ï¼Œå¦‚æœæ²¡æœ‰è¯»åˆ°è¿™ä¹ˆå¤šå­—ç¬¦ï¼Œ<code>read</code>ç³»ç»Ÿè°ƒç”¨ï¼ˆå‰é¢å†™äº†ï¼Œä¸²å£åœ¨linuxçœ‹æ¥æ˜¯ä¸ªæ–‡ä»¶ï¼‰å°±ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°è¶…æ—¶ä¸ºæ­¢ï¼Œæœ€å¤§ä½255ï¼ˆæ¯•ç«Ÿæ— ç¬¦å·çš„8ä½èƒ½è¡¨ç¤ºçš„æœ€å¤§æ•´æ•°ä¸è¿‡å¦‚æ­¤ï¼‰ã€‚<code>c_cc[VTIME]</code>ä¿å­˜äº†è¶…æ—¶ä¿¡æ¯ï¼ˆtimeoutï¼‰ï¼Œä¹Ÿå°±æ˜¯å¤šä¹…ç®—è¶…æ—¶ï¼Œå•ä½æ˜¯ååˆ†ç§’ï¼ˆ0.1ç§’ï¼Œdecisecondï¼‰ã€‚</p>
<h3 id="å…·ä½“çš„é…ç½®">å…·ä½“çš„é…ç½®</h3>
<p>å‚è€ƒç½‘ä¸Šçš„èµ„æ–™ï¼Œå¯¹äº<code>c_cflag</code>ï¼Œç¦ç”¨<code>PARENB</code>ã€<code>CSTOPB</code>ï¼Œæ„æ€æ˜¯ç¦ç”¨å¥‡å¶æ ¡éªŒï¼Œåªç”¨ä¸€ä¸ªåœæ­¢ä½ã€‚å¯ç”¨<code>CS8</code>ã€<code>CREAD</code>å’Œ<code>CLOCAL</code>ï¼Œå­—èŠ‚8ä½é•¿ï¼ˆç°åœ¨çœŸçš„è¿˜æœ‰ä»€ä¹ˆè®¾å¤‡å­—èŠ‚é•¿åº¦ä¸æ˜¯8ä½å—ï¼Ÿï¼‰ï¼Œå¯ä»¥è¯»å†™ã€‚å¯¹äº<code>c_lflag</code>ï¼Œç¦ç”¨<code>ICANON</code>ã€<code>ECHO</code>ã€<code>ECHOE</code>ã€<code>ECHONL</code>ã€<code>ISIG</code>ï¼Œç¦ç”¨æ ‡å‡†æ¨¡å¼ã€ä»»ä½•å›ä¼ ã€ä¿¡å·å­—èŠ‚ã€‚å¯¹äº<code>c_iflag</code>ï¼Œç¦ç”¨<code>IXOFF</code>ã€<code>IXON</code>ã€<code>IXANY</code>ï¼Œä¸è¦æµé‡æ§åˆ¶ï¼›ç¦ç”¨<code>IGNBRK</code>ã€<code>BRKINT</code>ã€<code>PARMRK</code>ã€<code>ISTRIP</code>ã€<code>INLCR</code>ã€<code>IGNCR</code>ã€<code>ICRNL</code>ï¼Œæˆ‘ä»¬è¦åŸå§‹æ•°æ®ï¼Œä¸è¦ç‰¹æ®Šå¤„ç†ã€‚å¯¹äº<code>c_oflag</code>ï¼Œç¦ç”¨<code>OPOST</code>ã€<code>ONLCR</code>ï¼Œä¸è¦ç‰¹æ®Šå¤„ç†ã€‚</p>
<p>æˆ‘è¿™é‡Œ<code>VMIN</code>è®¾ç½®ä¸º2ï¼Œå› ä¸ºæˆ‘é…ç½®äº†æˆ‘çš„Arduinoä¸€æ¬¡å‘é€ä¸¤ä¸ªå­—èŠ‚ã€‚VTIMEæˆ‘éšä¾¿è®¾ç½®äº†ä¸€ä¸ªå€¼ã€‚</p>
<p>æ³¢ç‰¹ç‡ä¹Ÿéœ€è¦è®¾ç½®ã€‚ä½¿ç”¨<code>cfsetispeed</code>å’Œ<code>cfsetospeed</code>å¯ä»¥åˆ†åˆ«è®¾ç½®è¯»å†™çš„æ³¢ç‰¹ç‡ã€‚æˆ‘è¿™é‡Œå…¨éƒ¨è®¾ä¸º9600Hzï¼Œä¹Ÿå°±æ˜¯B9600ã€‚</p>
<p>åœ¨çœ‹äº†Qtçš„<code>QSerialPort</code>å’Œrustçš„<code>serialport</code>
crateä¹‹åï¼Œæˆ‘å‘ç°è¿˜æ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„æ¥å£æœ€ä¸ºè¯¦ç»†å®Œå¤‡ã€‚</p>
<h3 id="æ€»ä½“å¤§è‡´æµç¨‹">æ€»ä½“å¤§è‡´æµç¨‹</h3>
<p>å…ˆ<code>open</code>å¯¹åº”çš„æ–‡ä»¶ï¼ˆæˆ‘è¿™é‡Œæ˜¯<code>/dev/ttyACM0</code>ï¼‰ï¼Œç„¶ååˆ©ç”¨<code>tcgetattr</code>è·å¾—ç»ˆç«¯æ§åˆ¶çš„ç»“æ„ä½“ï¼Œå¯¹å…¶è¿›è¡Œè®¾ç½®ï¼Œæ¥ä¸‹æ¥å°±å’Œæ™®é€šçš„æ–‡ä»¶ä¸€æ ·ï¼Œå¯ä»¥ä»é‡Œé¢<code>read</code>æ•°æ®äº†ã€‚æœ€åå†å…³é—­æ–‡ä»¶ã€‚</p>
<h2 id="cç¨‹åº">Cç¨‹åº</h2>
<div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdint.h&gt;</span><span class="cp"></span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fcntl.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;errno.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;termios.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>

<span class="c1">// handle memory in different ways</span>
<span class="c1">// convert two char into a uint16_t</span>
<span class="k">union</span><span class="w"> </span><span class="nc">Convert</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">num</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">serial_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="s">&quot;/dev/ttyACM0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">O_RDWR</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">serial_port</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Error %i from open: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">errno</span><span class="p">,</span><span class="w"> </span><span class="n">strerror</span><span class="p">(</span><span class="n">errno</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">termios</span><span class="w"> </span><span class="n">tty</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">tcgetattr</span><span class="p">(</span><span class="n">serial_port</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">tty</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Error %i from tcgetattr: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">errno</span><span class="p">,</span><span class="w"> </span><span class="n">strerror</span><span class="p">(</span><span class="n">errno</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">tty</span><span class="p">.</span><span class="n">c_cflag</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">PARENB</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">tty</span><span class="p">.</span><span class="n">c_cflag</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">CSTOPB</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">tty</span><span class="p">.</span><span class="n">c_cflag</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">CS8</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">tty</span><span class="p">.</span><span class="n">c_cflag</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">CREAD</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">CLOCAL</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">tty</span><span class="p">.</span><span class="n">c_lflag</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">ICANON</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">tty</span><span class="p">.</span><span class="n">c_lflag</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">ECHO</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">tty</span><span class="p">.</span><span class="n">c_lflag</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">ECHOE</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">tty</span><span class="p">.</span><span class="n">c_lflag</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">ECHONL</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">tty</span><span class="p">.</span><span class="n">c_lflag</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">ISIG</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">tty</span><span class="p">.</span><span class="n">c_iflag</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="p">(</span><span class="n">IXON</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">IXOFF</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">IXANY</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">tty</span><span class="p">.</span><span class="n">c_iflag</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="p">(</span><span class="n">IGNBRK</span><span class="o">|</span><span class="n">BRKINT</span><span class="o">|</span><span class="n">PARMRK</span><span class="o">|</span><span class="n">ISTRIP</span><span class="o">|</span><span class="n">INLCR</span><span class="o">|</span><span class="n">IGNCR</span><span class="o">|</span><span class="n">ICRNL</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">tty</span><span class="p">.</span><span class="n">c_oflag</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">OPOST</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">tty</span><span class="p">.</span><span class="n">c_oflag</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">ONLCR</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">tty</span><span class="p">.</span><span class="n">c_cc</span><span class="p">[</span><span class="n">VTIME</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">tty</span><span class="p">.</span><span class="n">c_cc</span><span class="p">[</span><span class="n">VMIN</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">cfsetispeed</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tty</span><span class="p">,</span><span class="w"> </span><span class="n">B9600</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">cfsetospeed</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tty</span><span class="p">,</span><span class="w"> </span><span class="n">B9600</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">read_buf</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span><span class="w"> </span><span class="c1">// buffer to use</span>
<span class="w">    </span><span class="k">union</span><span class="w"> </span><span class="nc">Convert</span><span class="w"> </span><span class="n">temp</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read</span><span class="p">(</span><span class="n">serial_port</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">read_buf</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">read_buf</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="c1">// ! should handle error here</span>
<span class="w">        </span><span class="c1">// but in my case, error rarely arises</span>
<span class="w">        </span><span class="n">temp</span><span class="p">.</span><span class="n">buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="n">temp</span><span class="p">.</span><span class="n">buffer</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read_buf</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">temp</span><span class="p">.</span><span class="n">num</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">close</span><span class="p">(</span><span class="n">serial_port</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>

<p>Arduinoæ–¹é¢ç¨‹åºå¦‚ä¸‹ã€‚è¿™é‡Œè¦æ³¨æ„ï¼Œä¸è¦ç”¨<code>Serial.println</code>ï¼ŒArduinoçš„åº“ä¼šå› æ­¤åœ¨åé¢åŠ ä¸Š<code>\r\n</code>ã€‚</p>
<div class="highlight"><pre><span></span><span class="k">union</span><span class="w"> </span><span class="nc">Convert</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="w"></span>
<span class="w">  </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">num</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="w"> </span>
<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">Convert</span><span class="w"> </span><span class="n">temp</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">temp</span><span class="p">.</span><span class="n">num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analogRead</span><span class="p">(</span><span class="n">A0</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">temp</span><span class="p">.</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>

<p>ç»æµ‹æœ€ç»ˆæ˜¯å¯ä»¥è¯»åˆ°æ•°æ®çš„ï¼Œè€Œä¸”é€Ÿåº¦å¾ˆå¿«ï¼Œä¸ä¼šå‡ºç°é€Ÿåº¦ä¸åŒ¹é…çš„é—®é¢˜ã€‚</p>
<h2 id="å…¶ä»–æ–¹æ³•">å…¶ä»–æ–¹æ³•</h2>
<p>æˆ‘è¿˜å°è¯•ä½¿ç”¨äº†Qtçš„<code>QSerialPort</code>æ¥è¯»ä¸²å£ï¼Œé‚£ä¸ªç”¨èµ·æ¥æ¯”ç›´æ¥è°ƒPOSIXæ¥å£ç®€å•å¤šäº†ã€‚ä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œæœ‰çš„æ—¶å€™åªè¯»äº†ä¸€ä¸ªå­—èŠ‚ï¼Œæœ‰çš„æ—¶å€™æŒ‰æˆ‘è¦æ±‚è¯»äº†ä¸¤ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯é«˜å­—èŠ‚å’Œä½å­—èŠ‚åäº†ã€‚ç”¨æ³•å¯ä»¥å‚è€ƒQtæ–‡æ¡£ã€‚</p>
<p>rustæœ‰ä¸ªcrateï¼Œ<code>serialport</code>ï¼Œä¹Ÿå¾ˆä¸é”™ï¼Œå¯¹åº•å±‚çš„æ“ä½œè¿›è¡Œäº†å°è£…ã€‚æˆ‘æœ€ç»ˆçš„ç¨‹åºå°±æ˜¯ç”¨äº†è¿™ä¸ªcrateã€‚ï¼ˆå› ä¸ºrustæœ‰å¾ˆæ–¹ä¾¿çš„çº¿ç¨‹åº“ï¼Œå†™èµ·æ¥æ²¡æœ‰Cè¯­è¨€è¿™ä¹ˆç´¯äººï¼‰</p>
<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>
<p>æ²¡æœ‰è¿™äº›å‚è€ƒèµ„æ–™æˆ‘çœŸçš„å†™ä¸å‡ºè¿™ä¸ªç¨‹åºã€‚</p>
<ol type="1">
<li><a
href="https://www.cmrr.umn.edu/~strupp/serial.html#CONTENTS">Serial
Programming Guide for POSIX Operating Systems</a></li>
<li><a
href="https://blog.mbedded.ninja/programming/operating-systems/linux/linux-serial-ports-using-c-cpp/">Linux
Serial Ports Using C/C++</a></li>
<li><a href="https://linux.die.net/man/3/termios">termios(3) - Linux man
page</a></li>
<li><a
href="https://en.wikipedia.org/wiki/Computer_terminal#:~:text=A%20computer%20terminal%20is%20an,a%20computer%20screen%20by%20decades.">Computer
terminal - Wikipedia</a></li>
<li><a href="https://docs.rs/serialport/4.0.1/serialport/">Crate
serialport</a></li>
<li><a href="https://doc.qt.io/qt-5/qserialport.html">QSerialPort
Class</a>dui</li>
</ol>

</div>

<div class="sibling-pages">
    
    <div class="sibling-page-arrow"><a href="//fpg2012.github.io/posts/2021-04-20-ç†ç”±.html">ã€ˆ</a></div>
    <div class="sibling-page sibling-page-next">
        <div class="sibling-page-title"><a href="//fpg2012.github.io/posts/2021-04-20-ç†ç”±.html">ç†ç”±</a></div>
        <div class="sibling-page-date">2021-04-20</div>
    </div>
    
    
    <div class="sibling-page sibling-page-last">
        <div class="sibling-page-title"><a href="//fpg2012.github.io/posts/2021-04-04-è§£é‡‘å­—å¡”é­”æ–¹.html">è§£é‡‘å­—å¡”é­”æ–¹...</a></div>
        <div class="sibling-page-date">2021-04-04</div>
    </div>
    <div class="sibling-page-arrow"><a href="//fpg2012.github.io/posts/2021-04-04-è§£é‡‘å­—å¡”é­”æ–¹.html">ã€‰</a></div>
    
</div>


<div class="comment-area">
    <div defer id="vcomments"></div>
</div>

</div>

        </main>
        <footer>
<span>Â© nth233 2022 | <span class="theme-about">Powered by <a href="https://github.com/fpg2012/sushi">sushi</a> |  Theme <a href="https://github.com/fpg2012/sushi-theme-empty">empty</a> by <a href="https://github.com/fpg2012">nth233</a></span>
</footer>
        <div id="fullscreen-img-container" class="hidden">
        </div>
        <div id="top-button" onclick="window.scrollTo(0,0)">â†¥</div>
	<script src="//fpg2012.github.io/assets/js/fullscreen-img.js"></script>
    <script>
        function setCookie(cname,cvalue,exdays,path) {
            var d = new Date();
            d.setTime(d.getTime()+(exdays*24*60*60*1000));
            var expires = "expires="+d.toGMTString();
            document.cookie = cname+"="+cvalue+"; "+expires+"; "+"path="+path;
        }
        function getCookie(cname){
            var name = cname + "=";
                var ca = document.cookie.split(';');
                for(var i=0; i<ca.length; i++) {
                    var c = ca[i].trim();
                    if (c.indexOf(name)==0) { return c.substring(name.length,c.length); }
                }
            return "";
        }

        var theme_switch = document.getElementById("theme-switch");
        var doc = document.documentElement;
        const themeMedia = window.matchMedia("(prefers-color-scheme: light)");
        var theme = "light";
        if (themeMedia.matches) {
            theme = "light";
        } else {
            theme = "dark";
        }
        if (getCookie("theme") != "") {
            theme = getCookie("theme");
        }
        var update_theme = function(to_theme) {
            if (theme == "light") {
                doc.removeAttribute("class");
                setCookie("theme", "light", 30, "/");
            } else {
                doc.setAttribute("class", "dark-theme")
                setCookie("theme", "dark", 30, "/");
            }
        }
        update_theme(theme);
        theme_switch.onclick = function() {
            if (theme == "light") {
                theme = "dark";
                update_theme("dark");
            } else {
                theme = "light";
                update_theme("light");
            }
        };
        themeMedia.addListener(e => {
            if (e.matches) {
                theme = "light";
                update_theme("light");
            } else {
                theme = "dark";
                update_theme("dark");
            }
        });
    </script>
    
    <script>
        window.addEventListener('load', (event) => {
            new Valine({
                el: '#vcomments',
                appId: 'z2BI9uqhDzhyed4haUSq5K98-gzGzoHsz',
                appKey: '4R2vpq8Wy392JAroRiaL7MJY'
            });
        });
    </script>
    
    </body>
</html>
