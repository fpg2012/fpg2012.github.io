<!DOCTYPE html>

<html>
    <head>
        
        <title>Empty Space - ä½¿ç”¨esp32-c3åˆ¶ä½œç½‘ç»œæ§åˆ¶é”®ç›˜</title>
        
        <meta charset="UTF-8">
        <meta content="width=device-width, initial-scale=1, viewport-fit=cover" name="viewport">

        
        <meta name="description" content="è“ç‰™é”®ç›˜é¼ æ ‡æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œä¸éœ€è¦çº¿ï¼Œä¹Ÿä¸éœ€è¦å ç”¨ä¸€ä¸ªUSBæ¥å£ï¼Œæœ‰äº›é”®ç›˜è¿˜å¯ä»¥å¤šæ¨¡åŒ¹é…ï¼Œåˆ‡æ¢è®¾å¤‡åªéœ€è¦æŒ‰ä¸€ä¸ªé”®ã€‚ä½†æœ‰ä¸€ä¸ªç¼ºç‚¹æ˜¯è“ç‰™é”®ç›˜é¿ä¸å¼€çš„ï¼šå¿…é¡»åœ¨æ“ä½œç³»ç»Ÿå¯åŠ¨ä¹‹åæ‰èƒ½ä½¿ç”¨ã€‚è¿™å°±å¸¦æ¥ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼šåœ¨GRUBä»¥åŠBIOSä¸­ï¼Œæ²¡æœ‰åŠæ³•ä½¿ç”¨è“ç‰™é”®ç›˜é¼ æ ‡ã€‚äºæ˜¯åœ¨æˆ‘æ¢è“ç‰™é”®ç›˜ä¹‹åï¼Œè¿˜æ˜¯ä¸å¾—ä¸å¸¸å¤‡ä¸€ä¸ªæœ‰çº¿é”®ç›˜æˆ–è€…2.4GHzçš„æ— çº¿é”®ç›˜â€”â€”ç›´æ¥æŠŠè“ç‰™é”®ç›˜çš„ç§ç§å¥½å¤„éƒ½æŠµæ¶ˆæ‰äº†ã€‚å¦‚æœæ‰‹è¾¹æ°å¥½æ²¡æœ‰æœ‰çº¿é”®ç›˜/2.4GHzæ— çº¿é”®ç›˜ï¼Œé‚£æˆ‘å°±æ— æ³•åœ¨å¼€æœºé€‰æ“ä½œç³»ç»Ÿã€‚å› æ­¤æˆ‘åšäº†è¿™ä¸ªä¸œè¥¿è¿›è¡Œè¡¥æ•‘ï¼šåŸºäºesp32-c3çš„ç½‘ç»œæ§åˆ¶é”®ç›˜ï¼ˆä¸‹æ–‡ç›´æ¥ç§°ä¸ºesp32é”®ç›˜ï¼‰ã€‚">
        

        
        <meta name="keywords" content="esp32,é”®ç›˜,ç”µå­,arduino">
        

        <link rel="stylesheet" href="//nth233.top/assets/style/main.css">
        <link rel="stylesheet" href="//nth233.top/assets/style/tango.css">
        <link rel="stylesheet" href="//nth233.top/assets/style/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous">

        
        
        <link rel="apple-touch-icon" sizes="180x180" href="//nth233.top/assets/favicon/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="//nth233.top/assets/favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="//nth233.top/assets/favicon/favicon-16x16.png">
        <link rel="manifest" href="//nth233.top/assets/favicon/site.webmanifest">
        
    </head>
    <body>
        <header>

<div class="header-logo">
    <img class="nth233logo" src="//nth233.top/assets/img/404.png"></img>
    <a href="//nth233.top/">Empty Space</a>
</div>

<div class="header-menu">
    <div id="search-button" class="search-control search-button">
        <svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 512 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6 .1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
    </div>
    <a href="//nth233.top/notes/">Notes</a>
    <a href="//nth233.top/about/">About</a>
    <a href="//nth233.top/feed.xml">RSS</a>
    <!--<a href="//nth233.top/friends.html">Friends</a>-->
    <div id="theme-switch" class="header-button" title="å¤œå¹•é™ä¸´">ğŸŒ’</div>
</div>
</header>
<div id="search-area" class="search-area hide">
    <input id="search-box" class="search-box" type="text">
    <div id="search-result-area">
    
    </div>
</div>
        <script src="//nth233.top/assets/js/switch-theme.js"></script>
        <main>
            
<div class='post-menu'>
    <div class='menu-title'>ä½¿ç”¨esp32-c3åˆ¶ä½œç½‘ç»œæ§åˆ¶é”®ç›˜</div>
    <hr>
</div> 
<div class="post-area">
<div class="post-front-matter">
    
    <h1>ä½¿ç”¨esp32-c3åˆ¶ä½œç½‘ç»œæ§åˆ¶é”®ç›˜</h1>
    
    <div class="date-bar">
        <span class="date">2024-02-08</span>
    </div>
    <div class="category-bar">
    
        <span class="category">ã€”devã€•</span>
    
    </div>
    <div class="tag-bar">
    
        <span class="tag">#esp32</span>
    
        <span class="tag">#é”®ç›˜</span>
    
        <span class="tag">#ç”µå­</span>
    
        <span class="tag">#arduino</span>
    
    </div>
</div>
<hr class="hr-wavy">
<div class="post-content">
    <p>è“ç‰™é”®ç›˜é¼ æ ‡æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œä¸éœ€è¦çº¿ï¼Œä¹Ÿä¸éœ€è¦å ç”¨ä¸€ä¸ªUSBæ¥å£ï¼Œæœ‰äº›é”®ç›˜è¿˜å¯ä»¥å¤šæ¨¡åŒ¹é…ï¼Œåˆ‡æ¢è®¾å¤‡åªéœ€è¦æŒ‰ä¸€ä¸ªé”®ã€‚ä½†æœ‰ä¸€ä¸ªç¼ºç‚¹æ˜¯è“ç‰™é”®ç›˜é¿ä¸å¼€çš„ï¼šå¿…é¡»åœ¨æ“ä½œç³»ç»Ÿå¯åŠ¨ä¹‹åæ‰èƒ½ä½¿ç”¨ã€‚</p>
<p>è¿™å°±å¸¦æ¥ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼šåœ¨GRUBä»¥åŠBIOSä¸­ï¼Œæ²¡æœ‰åŠæ³•ä½¿ç”¨è“ç‰™é”®ç›˜é¼ æ ‡ã€‚äºæ˜¯åœ¨æˆ‘æ¢è“ç‰™é”®ç›˜ä¹‹åï¼Œè¿˜æ˜¯ä¸å¾—ä¸å¸¸å¤‡ä¸€ä¸ªæœ‰çº¿é”®ç›˜æˆ–è€…2.4GHzçš„æ— çº¿é”®ç›˜â€”â€”ç›´æ¥æŠŠè“ç‰™é”®ç›˜çš„ç§ç§å¥½å¤„éƒ½æŠµæ¶ˆæ‰äº†ã€‚å¦‚æœæ‰‹è¾¹æ°å¥½æ²¡æœ‰æœ‰çº¿é”®ç›˜/2.4GHzæ— çº¿é”®ç›˜ï¼Œé‚£æˆ‘å°±æ— æ³•åœ¨å¼€æœºé€‰æ“ä½œç³»ç»Ÿã€‚</p>
<p>å› æ­¤æˆ‘åšäº†è¿™ä¸ªä¸œè¥¿è¿›è¡Œè¡¥æ•‘ï¼šåŸºäºesp32-c3çš„ç½‘ç»œæ§åˆ¶é”®ç›˜ï¼ˆä¸‹æ–‡ç›´æ¥ç§°ä¸ºesp32é”®ç›˜ï¼‰ã€‚</p>
<h2 id="å·¥ä½œæ–¹å¼">å·¥ä½œæ–¹å¼</h2>
<figure>
<img src="./structure.png" alt="å·¥ä½œæ–¹å¼ç¤ºæ„å›¾" />
<figcaption aria-hidden="true">å·¥ä½œæ–¹å¼ç¤ºæ„å›¾</figcaption>
</figure>
<p>å¤§æ¦‚å°±æ˜¯esp32-c3ç»ç”±ch9329ä¸²å£è½¬USB
HIDæ¨¡å—ï¼Œè¿æ¥åˆ°ä¸»æœºä¸Šï¼Œåœ¨ä¸»æœºçœ‹æ¥ï¼Œesp32-c3å°±æ˜¯ä¸ªUSBé”®é¼ ã€‚esp32-c3åŒæ—¶ä¹Ÿè¿æ¥åˆ°æœ¬åœ°çš„WiFiï¼Œå¹¶ä¸”è¿è¡Œä¸€ä¸ªHTTPæœåŠ¡ç«¯ã€‚è®¿é—®å®ƒä¼šè¿”å›ä¸€ä¸ªç½‘é¡µï¼Œç½‘é¡µä¸­æœ‰è‹¥å¹²æŒ‰é’®ï¼ŒæŒ‰ä¸‹ç½‘é¡µä¸Šçš„æŒ‰é’®æ—¶ä¼šç»™esp32-c3å‘è¯·æ±‚ã€‚esp32-c3è§£æè¯·æ±‚åï¼Œé€šè¿‡ch9329æ¨¡æ‹Ÿé”®ç›˜æŒ‰ä¸‹é‚£ä¸ªé”®ã€‚</p>
<p>æœ‰äº†è¿™ä¸ªesp32é”®ç›˜ä¹‹åï¼Œæˆ‘å°±å¯ä»¥é€šè¿‡æ‰‹æœºæ¨¡æ‹Ÿä¸€ä¸ªUSBé”®ç›˜çš„æ“ä½œï¼Œä»è€Œåœ¨GRUBç•Œé¢é‡Œé¢é€‰æ“ä½œç³»ç»Ÿï¼Œæ— éœ€å¸¸å¤‡ä¸€å—æœ‰çº¿é”®ç›˜ã€‚</p>
<h2 id="ææ–™">ææ–™</h2>
<ol type="1">
<li>esp32-c3-devkitm-1ï¼ˆæŸå®éšä¾¿ä¹°çš„ï¼‰</li>
<li>ch9329æ¨¡å—ï¼ˆæŸå®éšä¾¿ä¹°çš„ï¼‰</li>
<li>ssd1306 128x64çš„æ˜¾ç¤ºå±ï¼ˆå¾ˆä¹…ä»¥å‰æŸå®ä¹°çš„ï¼‰ï¼ˆå¯é€‰ï¼‰</li>
<li>æœé‚¦çº¿è‹¥å¹²</li>
</ol>
<h2 id="ç”¨åˆ°çš„åº“">ç”¨åˆ°çš„åº“</h2>
<ol type="1">
<li>å‚ç…§ä¹é‘«å®˜ç½‘é…å¥½Arduino IDEï¼ˆä¹Ÿå°±æ˜¯å®‰è£…esp32å¼€å‘æ¿ï¼‰</li>
<li>åœ¨Arduino IDEå®‰è£…u8g2åº“ï¼Œç”¨æ¥æ“ä½œæ˜¾ç¤ºå±ï¼ˆå¯é€‰ï¼‰</li>
<li>åœ¨Arduino IDEå®‰è£…CH9219_Keyboardåº“</li>
</ol>
<h2 id="å¯¼çº¿è¿æ¥">å¯¼çº¿è¿æ¥</h2>
<p>å¦‚å›¾æ‰€ç¤º</p>
<figure>
<img src="./connection.png" alt="å¯¼çº¿è¿æ¥" />
<figcaption aria-hidden="true">å¯¼çº¿è¿æ¥</figcaption>
</figure>
<h2 id="ä»£ç ">ä»£ç </h2>
<div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;WiFi.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;WiFiClient.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;WebServer.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;uri/UriBraces.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Arduino.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;U8g2lib.h&gt;</span>

<span class="cp">#ifdef U8X8_HAVE_HW_SPI</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;SPI.h&gt;</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef U8X8_HAVE_HW_I2C</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Wire.h&gt;</span>
<span class="cp">#endif</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CH9329_Keyboard.h&quot;</span>

<span class="cp">#define WIFI_SSID &quot;ä½ çš„WiFiå(SSID)&quot;</span>
<span class="cp">#define WIFI_PASSWORD &quot;ä½ çš„WiFiå¯†ç &quot;</span>
<span class="c1">// Defining the WiFi channel speeds up the connection:</span>
<span class="cp">#define WIFI_CHANNEL 6</span>

<span class="n">U8G2_SSD1306_128X64_NONAME_F_HW_I2C</span><span class="w"> </span><span class="nf">u8g2</span><span class="p">(</span><span class="n">U8G2_R0</span><span class="p">,</span><span class="w"> </span><span class="cm">/* reset=*/</span><span class="w"> </span><span class="n">U8X8_PIN_NONE</span><span class="p">,</span><span class="w"> </span><span class="cm">/* clock=*/</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="cm">/* data=*/</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>

<span class="n">WebServer</span><span class="w"> </span><span class="nf">server</span><span class="p">(</span><span class="mi">80</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">press_up</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">press_down</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">press_right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">press_left</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">press_enter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="cp">#define QUEUE_SIZE 7</span>
<span class="kt">int</span><span class="w"> </span><span class="n">press_history_queue</span><span class="p">[</span><span class="n">QUEUE_SIZE</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">};</span>
<span class="kt">int</span><span class="w"> </span><span class="n">p_front</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">p_rear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">queue_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="kt">char</span><span class="w"> </span><span class="n">queue_str</span><span class="p">[</span><span class="n">QUEUE_SIZE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span><span class="p">];</span>
<span class="kt">char</span><span class="w"> </span><span class="n">queue_str_map</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="sc">&#39;0&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;U&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;D&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;L&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;R&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;E&#39;</span><span class="p">};</span>

<span class="kt">int</span><span class="w"> </span><span class="n">position_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">position_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="kt">uint64_t</span><span class="w"> </span><span class="n">counter_default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4096</span><span class="p">;</span>
<span class="kt">uint64_t</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">counter_default</span><span class="p">;</span>

<span class="kt">uint64_t</span><span class="w"> </span><span class="n">counter_close_display_default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32768</span><span class="p">;</span>
<span class="kt">uint64_t</span><span class="w"> </span><span class="n">counter_close_display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">counter_close_display_default</span><span class="p">;</span>

<span class="kt">uint64_t</span><span class="w"> </span><span class="n">cycles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">real_cycles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">pop_queue</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">queue_len</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">p_front</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">p_front</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">QUEUE_SIZE</span><span class="p">;</span>
<span class="w">  </span><span class="n">queue_len</span><span class="w"> </span><span class="o">--</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">push_queue</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">item</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">queue_len</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">QUEUE_SIZE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">pop_queue</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">press_history_queue</span><span class="p">[</span><span class="n">p_rear</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="p">;</span>
<span class="w">  </span><span class="n">p_rear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">p_rear</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">QUEUE_SIZE</span><span class="p">;</span>
<span class="w">  </span><span class="n">queue_len</span><span class="w"> </span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">update_queue_str</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">queue_len</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">queue_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queue_str_map</span><span class="p">[</span><span class="n">press_history_queue</span><span class="p">[(</span><span class="n">p_front</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">QUEUE_SIZE</span><span class="p">]];</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">queue_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">update_position</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">position_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">position_x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
<span class="w">  </span><span class="n">position_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">position_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
<span class="w">  </span><span class="n">updateDisplay</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">updateDisplay</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">u8g2</span><span class="p">.</span><span class="n">clearBuffer</span><span class="p">();</span><span class="w">                   </span><span class="c1">// clear the internal memory</span>
<span class="w">  </span><span class="n">u8g2</span><span class="p">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">u8g2_font_t0_15b_tn</span><span class="p">);</span><span class="w">    </span><span class="c1">// choose a suitable font</span>
<span class="w">  </span><span class="n">u8g2</span><span class="p">.</span><span class="n">drawStr</span><span class="p">(</span><span class="n">position_x</span><span class="p">,</span><span class="n">position_y</span><span class="o">+</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">WiFi</span><span class="p">.</span><span class="n">localIP</span><span class="p">().</span><span class="n">toString</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span><span class="w">    </span><span class="c1">// write something to the internal memory</span>
<span class="w">  </span>
<span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="n">cycles_str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="s">&quot;LOOP/1024=&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">cycles</span><span class="p">);</span>
<span class="w">  </span><span class="n">u8g2</span><span class="p">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">u8g2_font_chikita_tr</span><span class="p">);</span>
<span class="w">  </span><span class="n">u8g2</span><span class="p">.</span><span class="n">drawStr</span><span class="p">(</span><span class="n">position_x</span><span class="p">,</span><span class="w"> </span><span class="n">position_y</span><span class="o">+</span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="n">cycles_str</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">  </span><span class="n">u8g2</span><span class="p">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">u8g2_font_tenstamps_mf</span><span class="p">);</span><span class="w"> </span><span class="c1">// choose a suitable font</span>
<span class="w">  </span><span class="n">u8g2</span><span class="p">.</span><span class="n">drawStr</span><span class="p">(</span><span class="n">position_x</span><span class="p">,</span><span class="n">position_y</span><span class="o">+</span><span class="mi">34</span><span class="p">,</span><span class="w"> </span><span class="n">queue_str</span><span class="p">);</span><span class="w">    </span><span class="c1">// write something to the internal memory</span>
<span class="w">  </span><span class="n">u8g2</span><span class="p">.</span><span class="n">sendBuffer</span><span class="p">();</span><span class="w">                    </span><span class="c1">// transfer internal memory to the display</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">closeDisplay</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">u8g2</span><span class="p">.</span><span class="n">clearBuffer</span><span class="p">();</span>
<span class="w">  </span><span class="n">u8g2</span><span class="p">.</span><span class="n">sendBuffer</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">sendHtml</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sa">R</span><span class="s">&quot;</span><span class="dl">(</span>
<span class="s">    &lt;!DOCTYPE html&gt;&lt;html&gt;</span>
<span class="s">      &lt;head&gt;</span>
<span class="s">        &lt;title&gt;ESP32 Web Server Demo&lt;/title&gt;</span>
<span class="s">        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;</span>
<span class="s">        &lt;style&gt;</span>
<span class="s">          html { font-family: sans-serif; text-align: center; width: 100vw; }</span>
<span class="s">          body { display: inline-flex; flex-direction: column; }</span>
<span class="s">          h1 { margin-bottom: 1.2em; } </span>
<span class="s">          h2 { margin: 0; }</span>
<span class="s">          div { display: flex; flex-wrap: wrap; }</span>
<span class="s">          .btn { background-color: #5B5; border: none; color: #fff; padding: 0.5em 1em;</span>
<span class="s">                 font-size: 2em; text-decoration: none; margin: 0.5em; }</span>
<span class="s">          .btn.OFF { background-color: #333; }</span>
<span class="s">          }</span>
<span class="s">        &lt;/style&gt;</span>
<span class="s">      &lt;/head&gt;</span>
<span class="s">            </span>
<span class="s">      &lt;body&gt;</span>
<span class="s">        &lt;h1&gt;ESP32 Web Server&lt;/h1&gt;</span>

<span class="s">        &lt;div class=&quot;button-area&quot;&gt;</span>
<span class="s">          &lt;span id=&quot;up&quot; class=&quot;btn&quot;&gt;up&lt;/span&gt;</span>
<span class="s">          &lt;span id=&quot;down&quot; class=&quot;btn&quot;&gt;down&lt;/span&gt;</span>
<span class="s">          &lt;span id=&quot;left&quot; class=&quot;btn&quot;&gt;left&lt;/span&gt;</span>
<span class="s">          &lt;span id=&quot;right&quot; class=&quot;btn&quot;&gt;right&lt;/span&gt;</span>
<span class="s">          &lt;span id=&quot;enter&quot; class=&quot;btn&quot;&gt;ENTER&lt;/span&gt;</span>
<span class="s">        &lt;/div&gt;</span>
<span class="s">        &lt;script&gt;</span>
<span class="s">          var up = document.getElementById(&quot;up&quot;);</span>
<span class="s">          var down = document.getElementById(&quot;down&quot;);</span>
<span class="s">          var right = document.getElementById(&quot;right&quot;);</span>
<span class="s">          var left = document.getElementById(&quot;left&quot;);</span>
<span class="s">          var enter = document.getElementById(&quot;enter&quot;);</span>

<span class="s">          up.onclick = async function() {</span>
<span class="s">            await fetch(&quot;/press/1&quot;);</span>
<span class="s">          }</span>
<span class="s">          down.onclick = async function() {</span>
<span class="s">            await fetch(&quot;/press/2&quot;);</span>
<span class="s">          }</span>
<span class="s">          right.onclick = async function() {</span>
<span class="s">            await fetch(&quot;/press/3&quot;);</span>
<span class="s">          }</span>
<span class="s">          left.onclick = async function() {</span>
<span class="s">            await fetch(&quot;/press/4&quot;);</span>
<span class="s">          }</span>
<span class="s">          enter.onclick = async function() {</span>
<span class="s">            await fetch(&quot;/press/5&quot;);</span>
<span class="s">          }</span>
<span class="s">        &lt;/script&gt;</span>
<span class="s">      &lt;/body&gt;</span>
<span class="s">    &lt;/html&gt;</span>
<span class="s">  </span><span class="dl">)</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">server</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text/html&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">);</span>
<span class="w">  </span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
<span class="w">  </span><span class="n">Serial1</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">,</span><span class="w"> </span><span class="n">SERIAL_8N1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">CH9329_Keyboard</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="n">Serial1</span><span class="p">);</span>

<span class="w">  </span><span class="n">WiFi</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="n">WIFI_SSID</span><span class="p">,</span><span class="w"> </span><span class="n">WIFI_PASSWORD</span><span class="p">,</span><span class="w"> </span><span class="n">WIFI_CHANNEL</span><span class="p">);</span>
<span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Connecting to WiFi &quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">WIFI_SSID</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// Wait for connection</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">status</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">WL_CONNECTED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot; Connected!&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;IP address: &quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">localIP</span><span class="p">());</span>

<span class="w">  </span><span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sendHtml</span><span class="p">);</span>

<span class="w">  </span><span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="n">UriBraces</span><span class="p">(</span><span class="s">&quot;/press/{}&quot;</span><span class="p">),</span><span class="w"> </span><span class="p">[]()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">press_button</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">server</span><span class="p">.</span><span class="n">pathArg</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Press #&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">press_button</span><span class="p">);</span>

<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">press_button</span><span class="p">.</span><span class="n">toInt</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span>
<span class="w">        </span><span class="c1">// up</span>
<span class="w">        </span><span class="n">CH9329_Keyboard</span><span class="p">.</span><span class="n">press</span><span class="p">(</span><span class="n">KEY_UP_ARROW</span><span class="p">);</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span>
<span class="w">        </span><span class="c1">// down</span>
<span class="w">        </span><span class="n">CH9329_Keyboard</span><span class="p">.</span><span class="n">press</span><span class="p">(</span><span class="n">KEY_DOWN_ARROW</span><span class="p">);</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="mi">3</span><span class="p">:</span>
<span class="w">        </span><span class="c1">// right</span>
<span class="w">        </span><span class="n">CH9329_Keyboard</span><span class="p">.</span><span class="n">press</span><span class="p">(</span><span class="n">KEY_RIGHT_ARROW</span><span class="p">);</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="mi">4</span><span class="p">:</span>
<span class="w">        </span><span class="c1">// left</span>
<span class="w">        </span><span class="n">CH9329_Keyboard</span><span class="p">.</span><span class="n">press</span><span class="p">(</span><span class="n">KEY_LEFT_ARROW</span><span class="p">);</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="mi">5</span><span class="p">:</span>
<span class="w">        </span><span class="c1">// enter</span>
<span class="w">        </span><span class="n">CH9329_Keyboard</span><span class="p">.</span><span class="n">press</span><span class="p">(</span><span class="n">KEY_RETURN</span><span class="p">);</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">push_queue</span><span class="p">(</span><span class="n">press_button</span><span class="p">.</span><span class="n">toInt</span><span class="p">());</span>
<span class="w">    </span><span class="n">update_queue_str</span><span class="p">();</span>
<span class="w">    </span><span class="n">updateDisplay</span><span class="p">();</span>

<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">queue_str</span><span class="p">);</span>

<span class="w">    </span><span class="n">server</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
<span class="w">    </span><span class="n">CH9329_Keyboard</span><span class="p">.</span><span class="n">releaseAll</span><span class="p">();</span>

<span class="w">    </span><span class="n">counter_close_display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32768</span><span class="p">;</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="n">server</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
<span class="w">  </span><span class="n">u8g2</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
<span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;HTTP server started&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">updateDisplay</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">server</span><span class="p">.</span><span class="n">handleClient</span><span class="p">();</span>
<span class="w">  </span><span class="n">delay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">real_cycles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">real_cycles</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">1024</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">real_cycles</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1023</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">cycles</span><span class="o">++</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">counter</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">counter</span><span class="o">--</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">counter_default</span><span class="p">;</span>
<span class="w">    </span><span class="n">update_position</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">counter_close_display</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">counter_close_display</span><span class="o">--</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">closeDisplay</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>æ³¨ï¼šæ˜¾ç¤ºå±åªæ˜¯ä¸ºäº†æ–¹ä¾¿çœ‹IPåœ°å€ã€‚å¦‚æœä½ ä¸éœ€è¦æ˜¾ç¤ºå±ï¼Œå°±æŠŠu8g2ç›¸å…³çš„ä¸œè¥¿å…¨éƒ¨åˆ æ‰</p>
</blockquote>
<blockquote>
<p>æ³¨2ï¼šè®°å¾—æŠŠWiFiåï¼ˆSSIDï¼‰å’Œå¯†ç æ¢æˆè‡ªå·±çš„</p>
</blockquote>
<h2 id="ç»“æœ">ç»“æœ</h2>
<div
style="display: grid; gap: 10px; grid-template-columns: 1.16fr 1fr; grid-template-rows: 1fr 1fr;">
<img src="./pic1.jpg" style="grid-column: 1; grid-row: 1"><img src="./pic2.jpg" style="grid-column: 1; grid-row: 2"><img src="./pic3.jpg" style="grid-column: 2; grid-row: 1 / 3">
</div>
<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<ul>
<li><a
href="https://wokwi.com/projects/320964045035274834">wokwiä¸Šçš„esp32HTTPæœåŠ¡å™¨ç¤ºä¾‹</a></li>
<li><a href="https://github.com/olikraus/u8g2/wiki">u8g2</a></li>
<li><a href="https://github.com/shigobu/CH9329_Keyboard">CH9329_Keyboard
(by shigobu)</a></li>
<li><a
href="https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32c3/hw-reference/esp32c3/user-guide-devkitm-1.html">esp32-c3-devkitm-1æ–‡æ¡£</a></li>
</ul>

</div>

<div class="sibling-pages">
    
    <div class="sibling-page-arrow"><a href="//nth233.top/posts/2024-03-14-OpenGLåŠ è½½å’Œç»˜åˆ¶glTFæ¨¡å‹/index.html">ã€ˆ</a></div>
    <div class="sibling-page sibling-page-next">
        <div class="sibling-page-title"><a href="//nth233.top/posts/2024-03-14-OpenGLåŠ è½½å’Œç»˜åˆ¶glTFæ¨¡å‹/index.html">OpenGLåŠ è½½g...</a></div>
        <div class="sibling-page-date">2024-03-14</div>
    </div>
    
    
    <div class="sibling-page sibling-page-last">
        <div class="sibling-page-title"><a href="//nth233.top/posts/2023-09-03-intel-arc-a770-ai.html">ä½¿ç”¨Intel A...</a></div>
        <div class="sibling-page-date">2023-09-03</div>
    </div>
    <div class="sibling-page-arrow"><a href="//nth233.top/posts/2023-09-03-intel-arc-a770-ai.html">ã€‰</a></div>
    
</div>




    <div class="comment-area">
<script src="https://utteranc.es/client.js"
        repo="fpg2012/fpg2012.github.io"
        issue-term="pathname"
        label="Comment"
        theme="preferred-color-scheme"
        crossorigin="anonymous"
        async>
</script>
</div>


</div>
<script src=//nth233.top/assets/js/generate-toc.js></script>

        </main>
        <script src="//nth233.top/assets/js/search.js"></script>
        <footer>
<span>Â© nth233 2024 | <span class="theme-about">Powered by <a href="https://github.com/fpg2012/sushi">sushi</a> |  Theme <a href="https://github.com/fpg2012/sushi-theme-empty">empty</a> by <a href="https://github.com/fpg2012">nth233</a></span>
</footer>
        <div id="fullscreen-img-container" class="hidden">
        </div>
        <div id="top-button" onclick="window.scrollTo(0,0)">â–³</div>
	<script src="//nth233.top/assets/js/fullscreen-img.js"></script>
    
    </body>
</html>
